# Frontend Audit Report - 2026-02-15

## Executive Summary
The frontend codebase is currently in a fractured state regarding styling. A legacy BEM-like CSS system coexists with a modern Tailwind CSS implementation. This results in code duplication, maintenance overhead, and inconsistent UI patterns. Additionally, the client-side authentication logic presents potential security risks if not properly validated by the backend.

## üö® Critical Vulnerabilities

### 1. Insecure Client-Side Authorization Logic
*   **Files:**
    *   `frontend/src/context/AuthContext.jsx` (lines ~32)
    *   `frontend/src/services/api.js` (lines ~38)
*   **Issue:** The application relies on `localStorage` to store authentication state (`isAdmin`, `username`) and manually attaches an `X-Admin-User` header to requests.
*   **Risk:** If the backend uses the presence of the `X-Admin-User` header as the *sole* proof of authorization, an attacker can easily spoof this header or modify `localStorage` to gain admin access.
*   **Recommendation:**
    *   Ensure the backend relies **strictly** on HTTP-only session cookies (indicated by `withCredentials: true` in `api.js`).
    *   Treat client-side `localStorage` data only as a UI hint (to show/hide buttons), never as a security gate.
    *   Remove the manual `X-Admin-User` header injection if the cookie-based session is sufficient.

## ‚ö†Ô∏è Architectural Issues (Styling)

### 1. Fractured Styling System (Vanilla CSS vs. Tailwind)
The project currently maintains two parallel styling systems:

1.  **Legacy System (Vanilla CSS + BEM):**
    *   Relies on `frontend/src/design/tokens.css` which manually defines CSS variables for colors, spacing, and typography.
    *   Uses a custom BEM-like naming convention (e.g., `.md3-button`, `.md3-elevation-1`).
    *   Heavily used in core UI components (`Button`, `Card`, `TextField`) and older pages.

2.  **Modern System (Tailwind CSS):**
    *   Configured in `frontend/tailwind.config.js`.
    *   Uses the same Zinc color palette but defined separately in the Tailwind config.
    *   Used in newer components (`Sidebar`, `AdminPanel`).

**Impact:**
*   **Duplication:** Color palettes and design tokens are defined in two places (`tokens.css` vs `tailwind.config.js`).
*   **Inconsistency:** New developers might not know which system to use.
*   **Bundle Size:** Shipping both a large CSS file and Tailwind utility classes increases payload size.

### 2. List of Legacy CSS Files
The following **37 files** contain legacy CSS that should be refactored to Tailwind utility classes to unify the codebase:

**Core Design:**
- `frontend/src/design/tokens.css` (The root of the legacy system)
- `frontend/src/index.css` (Contains global styles and Tailwind directives)

**UI Components (Priority for Refactoring):**
- `frontend/src/components/ui/Badge.css`
- `frontend/src/components/ui/Button.css`
- `frontend/src/components/ui/Card.css`
- `frontend/src/components/ui/Chip.css`
- `frontend/src/components/ui/DataTable.css`
- `frontend/src/components/ui/Icon.css`
- `frontend/src/components/ui/QuickActionCard.css`
- `frontend/src/components/ui/Select.css`
- `frontend/src/components/ui/SettingsModal.css`
- `frontend/src/components/ui/Snackbar.css`
- `frontend/src/components/ui/TextField.css`
- `frontend/src/components/ui/ThemeToggle.css`

**Layout & Pages:**
- `frontend/src/components/layout/AppShell.css`
- `frontend/src/components/layout/TopHeader.css`
- `frontend/src/pages/AdminDevicePage.css`
- `frontend/src/pages/Dashboard.css`
- `frontend/src/pages/Home.css`
- `frontend/src/pages/Login.css`

**Dashboard Components:**
- `frontend/src/components/dashboard/ActivityFeed.css`
- `frontend/src/components/dashboard/DashboardBox.css`
- `frontend/src/components/dashboard/DeviceDetailView.css`
- `frontend/src/components/dashboard/MetricCard.css`
- `frontend/src/components/dashboard/MinimalTimeSelector.css`
- `frontend/src/components/dashboard/TimeWindowSelector.css`

**Admin Components:**
- `frontend/src/components/admin/AdminCombinedGraph.css`
- `frontend/src/components/admin/AdminStatsCards.css`
- `frontend/src/components/admin/BoardAnalysisView.css`
- `frontend/src/components/admin/BoardCard.css`
- `frontend/src/components/admin/DeviceActionsMenu.css`
- `frontend/src/components/admin/DeviceCustomizationModal.css`
- `frontend/src/components/admin/DeviceDetailsModal.css`
- `frontend/src/components/admin/DeviceRenameModal.css`
- `frontend/src/components/admin/OfflineInfoTooltip.css`

**Other:**
- `frontend/src/components/DataLab/DataLab.css`
- `frontend/src/components/DeviceSelection.css`

## üí° Code Quality & Refactoring Suggestions

### 1. Inconsistent API Error Handling
*   **File:** `frontend/src/services/api.js`
*   **Issue:** `historyAPI` methods catch errors internally and return a resolved object `{ data: { status: 'error' } }`, whereas `dataAPI` methods let the promise reject (throw).
*   **Fix:** Standardize error handling. Ideally, let the API service throw errors and handle them in the UI layer or a global query manager (like React Query), or use a consistent return shape for all methods.

### 2. Component Modernization
*   Many components in `frontend/src/components/ui` (`Button.jsx`, `Card.jsx`) use `forwardRef` and prop drilling for styles (`className` string concatenation).
*   **Refactor Plan:** Re-implement these using Tailwind + `clsx` or `tailwind-merge` for cleaner class composition and easier overriding.
